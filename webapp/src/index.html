<html>
<head>
    <meta charset="utf-8">
    <script src="https://www.gstatic.com/firebasejs/3.6.4/firebase.js"></script>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"
            integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
            crossorigin="anonymous"></script>
    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyB6epSGVarzkV-QbcrJ-UKx6OWzuorb_Jw",
            authDomain: "hagifoo-firebase-todo.firebaseapp.com",
            databaseURL: "https://hagifoo-firebase-todo.firebaseio.com",
            storageBucket: "hagifoo-firebase-todo.appspot.com",
            messagingSenderId: "783427319643"
        };
        firebase.initializeApp(config);

        firebase.auth().signOut().then(function() {
            // Sign-out successful.
            firebase.auth().onAuthStateChanged(function(user) {
                if (user) {
                    // User is signed in.
                } else {
                    $.ajax({
                        method: 'GET',
                        url: '/api/token/firebase',
                        dataType: 'json'
                    }).done(function(data) {
                        console.log(data);

                        firebase.auth().signInWithCustomToken(data.token).then(function() {
                            firebase.database().ref('users/145').set({name: 'fuga'});
                        });
                    });
                }
            });
        }, function(error) {
            // An error happened.
        });

    </script>
</head>
<body>
<script type="text/javascript" src="../assets/main.js" charset="utf-8"></script>
</body>
</html>
